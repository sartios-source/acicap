{% extends "base.html" %}

{% block title %}ACI Capacity Atlas{% endblock %}

{% block content %}
<section class="layout">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div>
        <div class="sidebar-title">Fabrics</div>
        <div class="sidebar-sub">Manage & browse</div>
      </div>
      <button class="primary small" onclick="openFabricModal()">New</button>
    </div>
    <div class="sidebar-actions">
      <a class="ghost small" href="{{ url_for('upload_page') }}">Upload Data</a>
    </div>
    <input id="fabric-filter" class="sidebar-filter" placeholder="Filter fabrics..." oninput="filterFabrics()">
    <div class="fabric-list" id="fabric-list">
      {% for item in fabric_summaries %}
      <button class="fabric-item" data-fabric="{{ item.fabric }}" onclick="loadFabric('{{ item.fabric }}')">
        <div class="fabric-name">{{ item.fabric }}</div>
        <div class="fabric-meta">{{ item.meta.dataset_count }} datasets · {{ item.meta.modified }}</div>
        <div class="fabric-mini">
          <span>{{ item.summary.summary.leafs }} leafs</span>
          <span>{{ item.summary.summary.epgs }} epgs</span>
          <span>{{ item.summary.ports.ports_with_epg }} ports w/ epg</span>
        </div>
      </button>
      {% else %}
      <div class="empty">No fabrics yet.</div>
      {% endfor %}
    </div>
  </aside>

  <section class="content">
    <div class="summary-hero">
      <div>
        <h1>Capacity Summary</h1>
        <p>Fast, cached rollups across all fabrics. Select a fabric for full detail.</p>
      </div>
      <div class="summary-actions">
        <button class="ghost" onclick="loadFabric('all')">All Fabrics</button>
      </div>
    </div>

    <div class="summary-grid">
      <div class="summary-card">
        <div class="metric-title">Leafs</div>
        <div class="metric-value" data-count="{{ totals.leafs }}">0</div>
        <div class="metric-sub">Spines {{ totals.spines }}</div>
      </div>
      <div class="summary-card">
        <div class="metric-title">EPGs</div>
        <div class="metric-value" data-count="{{ totals.epgs }}">0</div>
        <div class="metric-sub">BDs {{ totals.bds }} · VRFs {{ totals.vrfs }}</div>
      </div>
      <div class="summary-card">
        <div class="metric-title">Tenants</div>
        <div class="metric-value" data-count="{{ totals.tenants }}">0</div>
        <div class="metric-sub">Endpoints {{ totals.endpoints }}</div>
      </div>
      <div class="summary-card">
        <div class="metric-title">Ports</div>
        <div class="metric-value" data-count="{{ totals.ports }}">0</div>
        <div class="metric-sub">Ports w/ EPG {{ totals.ports_with_epg }}</div>
      </div>
    </div>

    <div class="detail-panel" id="detail-panel">
      <div class="panel-header">
        <h3 id="detail-title">Select a fabric</h3>
        <div class="panel-actions">
          <span id="detail-meta" class="limit-meta">Cached summary view</span>
        </div>
      </div>
      <div id="detail-body" class="detail-body">
        <div class="empty">Choose a fabric from the left panel to load full details.</div>
      </div>
    </div>
  </section>
</section>

<div id="fabric-modal" class="modal hidden">
  <div class="modal-card">
    <h3>Create Fabric</h3>
    <input id="fabric-name" placeholder="fabric-name">
    <input id="fabric-desc" placeholder="description (optional)">
    <div class="modal-actions">
      <button class="ghost" onclick="closeFabricModal()">Cancel</button>
      <button class="primary" onclick="createFabric()">Create</button>
    </div>
  </div>
</div>
{% endblock %}
